{% extends "portfolios/base.html" %}

{% block title %}{{ watchlist.name }} · Watchlist · Subfolio{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
  <div>
    <h1 class="h3 mb-1">{{ watchlist.name }}</h1>
    <p class="text-body-secondary mb-0">Manage companies in this watchlist.</p>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'announcements:watchlist-index' %}">All watchlists</a>
    <a class="btn btn-outline-secondary" href="{% url 'announcements:feed' %}">Back to feed</a>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header">Rename watchlist</div>
  <div class="card-body">
    <form method="post" action="{% url 'announcements:watchlist-rename' watchlist.pk %}" class="row g-3 align-items-end">
      {% csrf_token %}
      <div class="col-md-6">
        {{ rename_form.name.label_tag }}
        {{ rename_form.name }}
        {% if rename_form.name.errors %}
          <div class="invalid-feedback d-block">{{ rename_form.name.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary">Rename</button>
      </div>
    </form>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header">Add a company</div>
  <div class="card-body">
    <form method="post" class="row g-3">
      {% csrf_token %}
      <div class="col-md-3">
        {{ form.ticker.label_tag }}
        {{ form.ticker }}
        {% if form.ticker.help_text %}
          <small class="form-text text-body-secondary">{{ form.ticker.help_text }}</small>
        {% endif %}
        {% if form.ticker.errors %}
          <div class="invalid-feedback d-block">{{ form.ticker.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-md-4">
        {{ form.name.label_tag }}
        {{ form.name }}
        {% if form.name.errors %}
          <div class="invalid-feedback d-block">{{ form.name.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-md-2">
        {{ form.isin.label_tag }}
        {{ form.isin }}
        {% if form.isin.errors %}
          <div class="invalid-feedback d-block">{{ form.isin.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-md-3">
        {{ form.website.label_tag }}
        {{ form.website }}
        {% if form.website.errors %}
          <div class="invalid-feedback d-block">{{ form.website.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Add company</button>
      </div>
    </form>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header">Companies</div>
  <div class="card-body">
    {% if entries %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th scope="col">Company</th>
              <th scope="col">Ticker</th>
              <th scope="col">ISIN</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
              <tr>
                <td>{{ entry.company.name }}</td>
                <td>{{ entry.company.ticker }}</td>
                <td>{{ entry.company.isin|default:"—" }}</td>
                <td>
                  <form method="post" action="{% url 'announcements:watchlist-remove-company' watchlist.pk entry.company.pk %}" class="d-inline" onsubmit="return confirm('Remove this company from the watchlist?')">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger btn-sm">Remove</button>
                  </form>
                  {% if entry.company.website %}
                    <a href="{{ entry.company.website }}" target="_blank" rel="noopener" class="btn btn-outline-secondary btn-sm">Website</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-body-secondary mb-0">No companies yet. Add one above to start tracking announcements.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
