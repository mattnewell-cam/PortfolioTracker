{% extends "portfolios/base.html" %}

{% block title %}Watchlists · Subfolio{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
  <div>
    <h1 class="h3 mb-1">Your watchlists</h1>
    <p class="text-body-secondary mb-0">Group companies to tailor which announcements you receive.</p>
  </div>
  <a class="btn btn-outline-secondary" href="{% url 'announcements:feed' %}">Back to feed</a>
</div>

<div class="card mt-4">
  <div class="card-header">Create a new watchlist</div>
  <div class="card-body">
    <form method="post" action="{% url 'announcements:watchlist-create' %}" class="row g-3 align-items-end">
      {% csrf_token %}
      <div class="col-md-6">
        {{ create_form.name.label_tag }}
        {{ create_form.name }}
        {% if create_form.name.errors %}
          <div class="invalid-feedback d-block">{{ create_form.name.errors|join:', ' }}</div>
        {% endif %}
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary">Create watchlist</button>
      </div>
    </form>
  </div>
</div>

{% if watchlists %}
  <div class="row row-cols-1 row-cols-lg-2 g-4 mt-3">
    {% for watchlist in watchlists %}
      <div class="col">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h2 class="h5 mb-1">{{ watchlist.name }}</h2>
                <p class="text-body-secondary mb-0">{{ watchlist.entries.count }} companies</p>
              </div>
              <div class="btn-group">
                <a href="{% url 'announcements:watchlist-detail' watchlist.pk %}" class="btn btn-outline-primary btn-sm">Manage</a>
                <form method="post" action="{% url 'announcements:watchlist-delete' watchlist.pk %}" onsubmit="return confirm('Delete this watchlist?')">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                </form>
              </div>
            </div>
            {% if watchlist.entries.all %}
              <ul class="list-unstyled mt-3 mb-0">
                {% for entry in watchlist.entries.all|slice:':5' %}
                  <li class="text-body-secondary">{{ entry.company.name }} ({{ entry.company.ticker }})</li>
                {% endfor %}
                {% if watchlist.entries.count > 5 %}
                  <li class="text-body-secondary">…and {{ watchlist.entries.count|add:'-5' }} more</li>
                {% endif %}
              </ul>
            {% else %}
              <p class="text-body-secondary mt-3 mb-0">No companies yet.</p>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info mt-4">Create your first watchlist to start tracking companies.</div>
{% endif %}
{% endblock %}
